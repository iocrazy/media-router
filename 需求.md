# 蚁小二 - 社交媒体管理平台开发计划

## 项目概述

基于对 yixiaoer.cn 的功能分析，开发一个多平台社交媒体内容管理和发布系统。

---

## 技术栈

### 前端
- **React** 19.2.3
- **TypeScript** 5.9.3
- **Tailwind CSS** 4.0
- **Vite** 7.3.1
- **状态管理**: Zustand 或 Jotai (轻量级，配合React 19)
- **路由**: React Router v7
- **UI组件**: Radix UI + Tailwind (无头组件)
- **表单**: React Hook Form + Zod
- **数据获取**: TanStack Query v5
- **图表**: Recharts 或 ECharts

### 后端

#### **推荐方案: FastAPI (Python)**

| 对比项 | FastAPI | Node.js (Express/Fastify) |
|--------|---------|---------------------------|
| **与Supabase集成** | ⭐⭐⭐ supabase-py 官方支持 | ⭐⭐⭐ @supabase/supabase-js |
| **异步处理** | ⭐⭐⭐ 原生async/await | ⭐⭐⭐ 原生异步 |
| **多平台API集成** | ⭐⭐⭐ httpx异步请求/OAuth处理成熟 | ⭐⭐⭐ axios/OAuth库完善 |
| **数据处理** | ⭐⭐⭐ pandas/numpy 数据分析强 | ⭐⭐ 需要额外库 |
| **类型安全** | ⭐⭐⭐ Pydantic 自动验证 | ⭐⭐ 需要手动配置 |
| **文档生成** | ⭐⭐⭐ 自动OpenAPI文档 | ⭐⭐ 需要swagger配置 |
| **定时任务** | ⭐⭐⭐ APScheduler/Celery | ⭐⭐ node-cron/bull |
| **AI集成(未来)** | ⭐⭐⭐ LangChain/OpenAI生态 | ⭐⭐ 可用但生态弱 |

**推荐理由:**
1. 数据分析和统计功能用Python更方便 (pandas/numpy)
2. FastAPI性能不输Node.js，自带OpenAPI文档
3. 多平台OAuth和API调用封装更简洁
4. 未来AI功能(如自动生成文案)扩展更容易 (LangChain生态)

### 数据库 & 认证
- **Supabase**: PostgreSQL + 实时订阅 + Row Level Security
- **存储**: Supabase Storage (素材文件)
- **认证**: Supabase Auth (手机号/邮箱登录)

### 部署
- **前端**: Vercel / Cloudflare Pages
- **后端**: Railway / Render / 阿里云函数计算
- **CDN**: Cloudflare

---

## 功能模块详细开发计划

### 模块1: 主页 (Dashboard)

**路由**: `/web` 或 `/web/dashboard`

**功能点**:
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 快捷发布入口 | 发视频、发图文、发文章、发公众号 4个快捷按钮 | P0 |
| 添加账号入口 | 引导用户绑定社交媒体账号 | P0 |
| 失效账号提醒 | 显示授权过期的账号数量，点击跳转处理 | P1 |
| 收藏分组 | 用户自定义账号分组，快速筛选 | P2 |
| 近30天趋势图 | 折线图展示发布数、粉丝、播放、评论、点赞、收藏 | P1 |
| 增长数据统计 | 昨日/近7日/近30日 数据卡片 | P1 |
| 平台新增数据 | 按平台分类的数据统计(抖音、快手、小红书等) | P2 |
| 常见问题 | FAQ列表，链接到帮助文档 | P3 |
| 系统公告 | 产品更新公告时间线 | P3 |
| 会员状态 | 显示当前套餐、账号点数、发布次数、云发布流量、素材库容量 | P1 |

**数据库表设计**:
```sql
-- 系统公告
CREATE TABLE announcements (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title TEXT NOT NULL,
  content TEXT,
  published_at TIMESTAMPTZ DEFAULT NOW(),
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- FAQ
CREATE TABLE faqs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  question TEXT NOT NULL,
  answer TEXT,
  link TEXT,
  sort_order INT DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

**前端组件**:
```
src/pages/Dashboard/
├── index.tsx              # 主页面
├── components/
│   ├── QuickActions.tsx   # 快捷发布按钮
│   ├── AccountStatus.tsx  # 账号状态卡片
│   ├── TrendChart.tsx     # 趋势图表
│   ├── GrowthStats.tsx    # 增长数据
│   ├── PlatformStats.tsx  # 平台分类统计
│   ├── MembershipCard.tsx # 会员状态
│   ├── Announcements.tsx  # 系统公告
│   └── FAQList.tsx        # 常见问题
```

---

### 模块2: 发布管理 (Publish)

**路由**: `/web/publish` (发布记录), `/web/tasks` (创建发布)

#### 2.1 发布记录页面

**功能点**:
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 发布记录列表 | 卡片式展示已发布/待发布的内容 | P0 |
| 筛选器 | 按负责人、发布类型、推送状态筛选 | P1 |
| 搜索 | 关键词搜索内容 | P1 |
| 批量删除 | 批量选择并删除发布记录 | P2 |
| 导出 | 导出发布记录 | P3 |
| 仅查看草稿 | 快速筛选草稿状态 | P2 |
| 新增发布 | 跳转到发布创建页面 | P0 |

#### 2.2 发布创建页面 (核心功能)

**功能点**:
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 发布类型选择 | 视频/图文/文章/公众号 | P0 |
| 账号选择器 | 多选目标发布账号，按平台分类 | P0 |
| 视频上传 | 支持拖拽上传，显示上传进度 | P0 |
| 封面设置 | 默认封面/自定义封面 | P1 |
| 标题填写 | 支持平台差异化标题 | P0 |
| 描述/正文 | 富文本编辑器 | P0 |
| 话题标签 | #添加话题，常用话题/标签管理 | P1 |
| 定时发布 | 设置发布时间 | P1 |
| 平台独立设置 | 不同平台的特殊参数配置 | P2 |
| 草稿保存 | 保存为草稿 | P1 |
| 立即发布 | 执行发布任务 | P0 |

**支持的平台** (根据截图):
- 国内: 抖音、快手、快手-Open、视频号、小红书、哔哩哔哩、哔哩哔哩-Open、百家号、新浪微博、知乎、企鹅号、搜狐号、一点号、大鱼号、网易号、爱奇艺、腾讯微视
- 海外: YouTube、TikTok、Instagram、Facebook、X(推特)

**数据库表设计**:
```sql
-- 发布任务
CREATE TABLE publish_tasks (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  team_id UUID REFERENCES teams(id),
  creator_id UUID REFERENCES auth.users(id),
  task_type VARCHAR(20) NOT NULL, -- video, image, article, wechat
  title TEXT NOT NULL,
  description TEXT,
  cover_url TEXT,
  scheduled_at TIMESTAMPTZ,
  status VARCHAR(20) DEFAULT 'draft', -- draft, pending, publishing, completed, failed
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 发布任务媒体文件
CREATE TABLE task_media (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  task_id UUID REFERENCES publish_tasks(id) ON DELETE CASCADE,
  media_type VARCHAR(20) NOT NULL, -- video, image
  file_url TEXT NOT NULL,
  file_size BIGINT,
  duration INT, -- 视频时长(秒)
  sort_order INT DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 发布任务账号关联
CREATE TABLE task_accounts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  task_id UUID REFERENCES publish_tasks(id) ON DELETE CASCADE,
  account_id UUID REFERENCES social_accounts(id),
  platform_title TEXT, -- 平台独立标题
  platform_description TEXT,
  status VARCHAR(20) DEFAULT 'pending', -- pending, publishing, success, failed
  error_message TEXT,
  published_url TEXT, -- 发布成功后的链接
  published_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 话题标签
CREATE TABLE hashtags (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  team_id UUID REFERENCES teams(id),
  name TEXT NOT NULL,
  usage_count INT DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

**前端组件**:
```
src/pages/Publish/
├── Records/
│   ├── index.tsx           # 发布记录列表
│   ├── RecordCard.tsx      # 发布记录卡片
│   └── Filters.tsx         # 筛选组件
├── Create/
│   ├── index.tsx           # 创建发布页面
│   ├── AccountSelector.tsx # 账号选择器
│   ├── MediaUploader.tsx   # 媒体上传组件
│   ├── CoverEditor.tsx     # 封面编辑
│   ├── ContentEditor.tsx   # 内容编辑器
│   ├── HashtagInput.tsx    # 话题输入
│   ├── SchedulePicker.tsx  # 定时设置
│   └── PlatformSettings.tsx # 平台独立设置
```

**后端API**:
```python
# FastAPI 路由
POST   /api/tasks              # 创建发布任务
GET    /api/tasks              # 获取任务列表
GET    /api/tasks/{id}         # 获取任务详情
PUT    /api/tasks/{id}         # 更新任务
DELETE /api/tasks/{id}         # 删除任务
POST   /api/tasks/{id}/publish # 执行发布
POST   /api/upload/media       # 上传媒体文件
```

---

### 模块3: 账号管理 (Accounts)

**路由**: `/web/accounts`

**子页面Tab**:
- 账号管理 (默认)
- 分组管理
- 收藏分组

**功能点**:
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 平台分类侧边栏 | 按平台筛选账号 | P0 |
| 账号列表 | 网格/列表两种视图 | P0 |
| 添加账号 | 授权绑定社交媒体账号 | P0 |
| 账号状态 | 显示已失效账号 | P0 |
| 批量操作 | 批量删除、批量设置负责人 | P2 |
| 账号设置 | 设置负责人、运营人、代理 | P1 |
| 重新登录 | 刷新过期授权 | P1 |
| 删除账号 | 解绑账号 | P1 |
| 分组管理 | 创建、编辑、删除账号分组 | P2 |
| 账号搜索 | 按名称搜索账号 | P1 |

**数据库表设计**:
```sql
-- 社交媒体账号
CREATE TABLE social_accounts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  team_id UUID REFERENCES teams(id),
  platform VARCHAR(50) NOT NULL, -- douyin, kuaishou, xiaohongshu, etc.
  platform_user_id TEXT NOT NULL, -- 平台用户ID
  username TEXT NOT NULL,
  avatar_url TEXT,
  access_token TEXT, -- 加密存储
  refresh_token TEXT,
  token_expires_at TIMESTAMPTZ,
  status VARCHAR(20) DEFAULT 'active', -- active, expired, invalid
  owner_id UUID REFERENCES team_members(id), -- 负责人
  operator_id UUID REFERENCES team_members(id), -- 运营人
  agent_id UUID REFERENCES team_members(id), -- 代理
  fans_count INT DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(team_id, platform, platform_user_id)
);

-- 账号分组
CREATE TABLE account_groups (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  team_id UUID REFERENCES teams(id),
  name TEXT NOT NULL,
  description TEXT,
  is_favorite BOOLEAN DEFAULT FALSE, -- 是否收藏分组
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 账号-分组关联
CREATE TABLE account_group_members (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  account_id UUID REFERENCES social_accounts(id) ON DELETE CASCADE,
  group_id UUID REFERENCES account_groups(id) ON DELETE CASCADE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(account_id, group_id)
);
```

**平台OAuth配置** (需要申请开发者账号):
```python
PLATFORM_CONFIGS = {
    "douyin": {
        "auth_url": "https://open.douyin.com/platform/oauth/connect/",
        "token_url": "https://open.douyin.com/oauth/access_token/",
        "scopes": ["user_info", "video.create", "video.data"]
    },
    "kuaishou": {
        "auth_url": "https://open.kuaishou.com/oauth2/authorize",
        "token_url": "https://open.kuaishou.com/oauth2/access_token",
        "scopes": ["user_info", "upload"]
    },
    # ... 其他平台
}
```

---

### 模块4: 数据分析 (Data/Overview)

**路由**: `/web/overview`

**子页面Tab**:
- 账号数据 (默认)
- 作品数据

#### 4.1 账号数据

**功能点**:
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 平台Tab切换 | 抖音、快手、小红书、视频号等所有平台 | P0 |
| 账号数据表格 | 播放量、主页访问、作品点赞、作品分享、作品评论、封面设置率、封面点击率、净增粉丝、取关粉丝、总粉丝量 | P0 |
| 筛选器 | 账号状态、分组、负责人 | P1 |
| 数据导出 | 导出为Excel | P2 |
| 刷新数据 | 手动触发数据同步 | P1 |
| 分页 | 分页展示 | P1 |

#### 4.2 作品数据

**功能点**:
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 作品列表 | 已发布作品的数据统计 | P0 |
| 数据指标 | 播放、点赞、评论、分享、收藏 | P0 |
| 作品详情 | 查看单个作品详细数据 | P1 |

**数据库表设计**:
```sql
-- 账号数据快照 (每日同步)
CREATE TABLE account_stats_daily (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  account_id UUID REFERENCES social_accounts(id) ON DELETE CASCADE,
  stat_date DATE NOT NULL,
  fans_count INT DEFAULT 0,
  fans_increment INT DEFAULT 0, -- 净增粉丝
  unfollows INT DEFAULT 0, -- 取关数
  play_count BIGINT DEFAULT 0,
  like_count BIGINT DEFAULT 0,
  comment_count BIGINT DEFAULT 0,
  share_count BIGINT DEFAULT 0,
  collect_count BIGINT DEFAULT 0, -- 收藏数
  profile_views INT DEFAULT 0, -- 主页访问
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(account_id, stat_date)
);

-- 作品数据
CREATE TABLE content_stats (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  account_id UUID REFERENCES social_accounts(id),
  platform_content_id TEXT NOT NULL, -- 平台作品ID
  title TEXT,
  cover_url TEXT,
  content_url TEXT, -- 作品链接
  content_type VARCHAR(20), -- video, image, article
  play_count BIGINT DEFAULT 0,
  like_count BIGINT DEFAULT 0,
  comment_count BIGINT DEFAULT 0,
  share_count BIGINT DEFAULT 0,
  collect_count BIGINT DEFAULT 0,
  published_at TIMESTAMPTZ,
  last_synced_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

**数据来源说明**:

> ⚠️ **重要**: 所有播放、粉丝、互动等数据都是通过**各平台官方创作者中心API**获取，而非爬虫抓取。
> 用户需要通过OAuth授权登录绑定账号后，系统才能调用平台开放API获取数据。

**后端定时任务** (使用APScheduler):
```python
from apscheduler.schedulers.asyncio import AsyncIOScheduler

scheduler = AsyncIOScheduler()

# 每小时通过创作者中心API同步账号数据
@scheduler.scheduled_job('interval', hours=1)
async def sync_account_stats():
    accounts = await get_all_active_accounts()
    for account in accounts:
        # 检查token是否有效
        if account.token_expires_at < datetime.now():
            await refresh_platform_token(account)
        # 调用平台官方API获取数据
        await fetch_creator_center_stats(account)

# 每天凌晨生成日报快照
@scheduler.scheduled_job('cron', hour=0, minute=30)
async def generate_daily_snapshot():
    await create_daily_stats_snapshot()
```

---

### 模块5: 团队管理 (Team)

**路由**: `/web/team`

**子页面Tab**:
- 成员
- 团队代理
- 团队订单

**功能点**:
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 团队信息 | 团队名称、团队ID、套餐类型 | P0 |
| 成员列表 | 成员信息、手机号、运营账号数、加入时间、角色 | P0 |
| 邀请成员 | 生成邀请链接或直接邀请 | P0 |
| 角色管理 | 创建人、管理员、成员 权限控制 | P1 |
| 批量操作 | 批量修改角色、移除成员 | P2 |
| 成员搜索 | 按名称/手机号搜索 | P1 |
| 团队代理 | 代理商管理功能 | P3 |
| 团队订单 | 订单记录查看 | P2 |

**数据库表设计**:
```sql
-- 团队
CREATE TABLE teams (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  team_code VARCHAR(20) UNIQUE, -- 团队ID如 A1PL54
  plan_type VARCHAR(20) DEFAULT 'free', -- free, basic, pro, enterprise
  plan_expires_at TIMESTAMPTZ,
  account_quota INT DEFAULT 5, -- 账号点数
  publish_quota INT DEFAULT 10, -- 发布次数
  storage_quota BIGINT DEFAULT 500 * 1024 * 1024, -- 素材库容量(bytes)
  storage_used BIGINT DEFAULT 0,
  owner_id UUID REFERENCES auth.users(id),
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 团队成员
CREATE TABLE team_members (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  team_id UUID REFERENCES teams(id) ON DELETE CASCADE,
  user_id UUID REFERENCES auth.users(id),
  nickname TEXT,
  phone TEXT,
  role VARCHAR(20) DEFAULT 'member', -- owner, admin, member
  status VARCHAR(20) DEFAULT 'active', -- active, invited, disabled
  invited_by UUID REFERENCES team_members(id),
  joined_at TIMESTAMPTZ DEFAULT NOW(),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(team_id, user_id)
);

-- 邀请记录
CREATE TABLE team_invitations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  team_id UUID REFERENCES teams(id),
  invite_code VARCHAR(20) UNIQUE,
  inviter_id UUID REFERENCES team_members(id),
  role VARCHAR(20) DEFAULT 'member',
  expires_at TIMESTAMPTZ,
  used_by UUID REFERENCES auth.users(id),
  used_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

### 模块6: 素材库 (Asset Library)

**路由**: `/web/asset-library`

**功能点**:
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 素材分组 | 创建文件夹分组管理 | P1 |
| 素材类型筛选 | 全部类型、图片、视频 | P0 |
| 上传素材 | 上传图片/视频到素材库 | P0 |
| 批量操作 | 批量删除、移动分组 | P2 |
| 素材预览 | 点击预览大图/视频 | P1 |
| 容量显示 | 显示已用/总容量 | P1 |
| 团队素材 | 团队共享素材 | P2 |
| 系统内容 | 平台提供的模板素材 | P3 |

**数据库表设计**:
```sql
-- 素材分组
CREATE TABLE asset_folders (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  team_id UUID REFERENCES teams(id),
  name TEXT NOT NULL,
  parent_id UUID REFERENCES asset_folders(id),
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 素材文件
CREATE TABLE assets (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  team_id UUID REFERENCES teams(id),
  folder_id UUID REFERENCES asset_folders(id),
  uploader_id UUID REFERENCES team_members(id),
  file_name TEXT NOT NULL,
  file_type VARCHAR(20) NOT NULL, -- image, video
  file_url TEXT NOT NULL, -- Supabase Storage URL
  file_size BIGINT NOT NULL,
  mime_type TEXT,
  width INT,
  height INT,
  duration INT, -- 视频时长
  thumbnail_url TEXT,
  is_team_shared BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

**Supabase Storage配置**:
```sql
-- 创建存储桶
INSERT INTO storage.buckets (id, name, public)
VALUES ('assets', 'assets', false);

-- RLS策略
CREATE POLICY "Team members can access assets"
ON storage.objects FOR SELECT
USING (
  bucket_id = 'assets' AND
  (storage.foldername(name))[1] IN (
    SELECT id::text FROM teams WHERE id IN (
      SELECT team_id FROM team_members WHERE user_id = auth.uid()
    )
  )
);
```

---

### 模块7: 私信评论 (Messages)

**路由**: `/web/messages` (或跳转外部服务)

**功能点**:
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 评论管理 | 查看所有账号收到的评论 | P1 |
| 私信管理 | 查看所有账号收到的私信 | P1 |
| 批量回复 | 批量回复评论/私信 | P2 |
| 自动回复 | 设置关键词自动回复规则 | P2 |
| 评论筛选 | 按账号、时间、状态筛选 | P1 |

> 注: 根据截图，此功能可能使用第三方服务(青蚕)

---

### 模块8: GEO优化

**说明**: 跳转到外部服务 zhuaci.com (抓词GEO)

**功能**:
- 关键词优化
- 搜索排名提升
- 内容SEO优化

> 此模块为第三方集成，暂不在MVP范围内

---

### 模块9: 用户认证 & 会员系统

**功能点**:
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 手机号登录 | 短信验证码登录 | P0 |
| 邮箱登录 | 邮箱密码登录 | P1 |
| 微信扫码登录 | 微信OAuth | P2 |
| 会员套餐 | 免费版、基础版、专业版、企业版 | P1 |
| 套餐购买 | 支付宝/微信支付 | P1 |
| 账号配额 | 不同套餐的账号/发布限制 | P0 |

**数据库表设计**:
```sql
-- 用户扩展信息
CREATE TABLE user_profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id),
  phone TEXT UNIQUE,
  nickname TEXT,
  avatar_url TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 订单记录
CREATE TABLE orders (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  team_id UUID REFERENCES teams(id),
  user_id UUID REFERENCES auth.users(id),
  plan_type VARCHAR(20) NOT NULL,
  amount DECIMAL(10,2) NOT NULL,
  payment_method VARCHAR(20), -- alipay, wechat
  payment_id TEXT, -- 第三方支付订单号
  status VARCHAR(20) DEFAULT 'pending', -- pending, paid, cancelled, refunded
  paid_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## 开发阶段规划

### 第一阶段: MVP (4-6周)

**Week 1-2: 基础架构**
- [ ] 项目初始化 (Vite + React + TypeScript + Tailwind)
- [ ] Supabase 配置 (数据库、认证、存储)
- [ ] FastAPI 项目搭建
- [ ] 基础UI组件库搭建
- [ ] 路由配置和布局组件

**Week 3-4: 核心功能**
- [ ] 用户认证 (登录/注册)
- [ ] 团队创建和管理
- [ ] 账号管理 (添加账号 - 先支持2-3个平台)
- [ ] 素材库基础功能

**Week 5-6: 发布功能**
- [ ] 发布任务创建
- [ ] 视频/图片上传
- [ ] 单平台发布测试
- [ ] 发布记录管理

### 第二阶段: 完善功能 (4周)

**Week 7-8:**
- [ ] 多平台发布支持扩展
- [ ] 定时发布功能
- [ ] 数据统计基础功能
- [ ] 团队成员邀请

**Week 9-10:**
- [ ] 数据同步定时任务
- [ ] 趋势图表展示
- [ ] 会员系统和支付
- [ ] 移动端适配

### 第三阶段: 优化和扩展 (持续)

- [ ] 更多平台支持
- [ ] 私信评论管理
- [ ] AI辅助功能 (文案生成)
- [ ] 性能优化
- [ ] 自动化测试

---

## 项目目录结构

### 前端
```
src/
├── components/           # 通用组件
│   ├── ui/              # 基础UI组件 (Button, Input, Modal等)
│   ├── layout/          # 布局组件 (Sidebar, Header, PageContainer)
│   └── common/          # 业务通用组件 (AccountCard, PlatformIcon等)
├── pages/               # 页面组件
│   ├── Dashboard/
│   ├── Publish/
│   ├── Accounts/
│   ├── Overview/
│   ├── Team/
│   ├── Assets/
│   └── Auth/
├── hooks/               # 自定义Hooks
├── stores/              # Zustand状态管理
├── services/            # API服务
├── utils/               # 工具函数
├── types/               # TypeScript类型定义
├── constants/           # 常量配置
└── styles/              # 全局样式
```

### 后端 (FastAPI)
```
app/
├── api/
│   ├── v1/
│   │   ├── auth.py
│   │   ├── teams.py
│   │   ├── accounts.py
│   │   ├── tasks.py
│   │   ├── assets.py
│   │   └── stats.py
│   └── deps.py          # 依赖注入
├── core/
│   ├── config.py        # 配置
│   ├── security.py      # 安全相关
│   └── supabase.py      # Supabase客户端
├── models/              # Pydantic模型
├── services/            # 业务逻辑
│   ├── platforms/       # 各平台API封装
│   │   ├── douyin.py
│   │   ├── kuaishou.py
│   │   └── ...
│   └── tasks/           # 发布任务处理
├── jobs/                # 定时任务
└── main.py
```

---

## 关键技术要点

### 1. 多平台OAuth授权 & 创作者中心API

> **核心机制**: 用户通过OAuth授权登录绑定社交媒体账号后，系统获取access_token/refresh_token，
> 调用各平台**官方创作者中心开放API**获取数据和执行发布操作。

**需要申请各平台开发者账号并完成资质认证**:

| 平台 | 开放平台 | 创作者API文档 | 主要能力 |
|------|----------|---------------|----------|
| 抖音 | open.douyin.com | 创作者数据API | 视频发布、数据统计、粉丝分析 |
| 快手 | open.kuaishou.com | 创作服务API | 视频上传、作品管理、数据查询 |
| 小红书 | open.xiaohongshu.com | 创作者开放平台 | 笔记发布、数据分析 |
| B站 | openhome.bilibili.com | UP主开放平台 | 视频投稿、数据中心 |
| 微博 | open.weibo.com | 微博API | 内容发布、粉丝数据 |
| 视频号 | channels.weixin.qq.com | 视频号助手API | 视频管理、数据分析 |
| YouTube | developers.google.com | YouTube Data API v3 | 视频上传、Analytics |
| TikTok | developers.tiktok.com | TikTok API | 视频发布、数据获取 |

**OAuth流程示例** (以抖音为例):
```python
# 1. 生成授权URL，引导用户登录
auth_url = f"https://open.douyin.com/platform/oauth/connect/?client_key={CLIENT_KEY}&response_type=code&scope=user_info,video.create,video.data&redirect_uri={REDIRECT_URI}"

# 2. 用户授权后，用code换取token
async def exchange_token(code: str):
    resp = await httpx.post("https://open.douyin.com/oauth/access_token/", data={
        "client_key": CLIENT_KEY,
        "client_secret": CLIENT_SECRET,
        "code": code,
        "grant_type": "authorization_code"
    })
    return resp.json()  # 包含 access_token, refresh_token, expires_in

# 3. 调用创作者中心API获取数据
async def get_creator_stats(access_token: str, open_id: str):
    headers = {"Authorization": f"Bearer {access_token}"}
    resp = await httpx.get(
        f"https://open.douyin.com/data/external/user/fans/?open_id={open_id}",
        headers=headers
    )
    return resp.json()  # 返回粉丝数据、播放数据等
```

### 2. 视频发布策略

**优先使用官方API发布**:
- 大部分平台都提供视频上传和发布API
- 通过OAuth获取的token具有发布权限 (需要申请对应scope)

**API发布流程**:
```python
async def publish_video_to_douyin(account, video_url, title, description):
    # 1. 上传视频文件获取video_id
    upload_resp = await upload_video_chunk(account.access_token, video_url)
    video_id = upload_resp["video_id"]

    # 2. 创建视频发布任务
    publish_resp = await httpx.post(
        "https://open.douyin.com/video/create/",
        headers={"Authorization": f"Bearer {account.access_token}"},
        json={
            "open_id": account.platform_user_id,
            "video_id": video_id,
            "text": f"{title}\n{description}",
            # 其他参数: 封面、话题、@用户等
        }
    )
    return publish_resp.json()
```

### 3. 数据同步 (通过官方API)

- 定时任务调用各平台**创作者中心数据API**
- Token过期前自动使用refresh_token刷新
- 注意各平台API调用频率限制 (rate limit)
- 数据存储到本地数据库，支持历史对比分析

### 4. 安全性

- 所有token加密存储
- Supabase RLS策略
- API请求签名验证
- 敏感操作二次验证

---

## 风险和挑战

1. **平台API变更**: 各社交平台API可能随时变更，需要持续维护
2. **开发者资质审核**: 部分平台开放API需要企业资质认证，审核周期长
3. **API权限申请**: 创作者数据API、发布API需要单独申请权限
4. **Token管理**: 需要妥善处理token刷新、过期、失效等情况
5. **API调用限制**: 各平台有不同的rate limit，需要做好限流
6. **并发处理**: 批量发布时的并发控制和错误重试
7. **文件存储成本**: 视频文件存储成本较高
8. **多平台适配**: 各平台API参数、返回格式差异大

---

## 总结

本文档详细分析了蚁小二平台的主要功能模块，并提供了完整的技术实现方案。建议按照分阶段开发计划逐步实现，先完成MVP核心功能，再逐步扩展。

**后端推荐使用 FastAPI**，主要因为:
1. 多平台OAuth和API集成代码简洁
2. 数据分析处理Python生态更成熟 (pandas)
3. 自带OpenAPI文档，开发效率高
4. 异步性能优秀，适合并发调用多平台API
5. 未来AI功能扩展更方便 (LangChain)

---

## 附录: 各平台开放平台申请链接

| 平台 | 开放平台地址 | 备注 |
|------|-------------|------|
| 抖音 | https://open.douyin.com | 需要企业认证 |
| 快手 | https://open.kuaishou.com | 需要企业认证 |
| 小红书 | https://open.xiaohongshu.com | 创作者开放平台 |
| B站 | https://openhome.bilibili.com | UP主开放平台 |
| 微博 | https://open.weibo.com | 微博开放平台 |
| 微信视频号 | https://channels.weixin.qq.com | 视频号助手 |
| YouTube | https://developers.google.com/youtube | Google Cloud Console |
| TikTok | https://developers.tiktok.com | TikTok for Developers |
| Instagram | https://developers.facebook.com | Meta for Developers |
| X (Twitter) | https://developer.twitter.com | X Developer Portal |